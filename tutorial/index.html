<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.24.1" />
    <meta name="description" content="">


    <title>Tutorial :: Outcome documentation</title>
    <link rel="shortcut icon" href="/outcome/images/favicon.png" type="image/x-icon" />
    <link href="/outcome/css/nucleus.css" rel="stylesheet">
    <link href="/outcome/css/font-awesome.min.css" rel="stylesheet">
    <link href="/outcome/css/hybrid.css" rel="stylesheet">
    <link href="/outcome/css/featherlight.min.css" rel="stylesheet">
    <link href="/outcome/css/horsey.css" rel="stylesheet">
    <link href="/outcome/css/theme.css" rel="stylesheet">
    <link rel="stylesheet" href="/outcome/css/bootstrap.min.css">
    <script src="/outcome/js/jquery-2.x.min.js"></script>
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left {
        display:none !important;
      }
    </style>

    

    <link href="/outcome/css/local.css" rel="stylesheet">

  </head>
  <body class="" data-url="/outcome/tutorial/">
    <nav id="sidebar" class="">
  <div id="header-wrapper">
    <div id="header">
       
	<p>Outcome 2.0 library documentation</p>
 


    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>
<script type="text/javascript" src="/outcome/js/lunr.min.js"></script>
<script type="text/javascript" src="/outcome/js/horsey.js"></script>
<script type="text/javascript">
    var baseurl = "https:\/\/ned14.github.io\/outcome\/";
</script>
<script type="text/javascript" src="/outcome/js/search.js"></script>

    
  </div>





<div class="highlightable">
    <ul class="topics">
        
        
            <li data-nav-id="/outcome/" class="dd-item">
            <a href="/outcome/"><i class="fa fa-fw fa-home"></i></a>
            </li>
        

        




<li data-nav-id="/outcome/requirements/" class="dd-item 



">
  <a href="/outcome/requirements/">
    <span>Prerequisites</span>

    
    <i class="fa fa-angle-right fa-lg category-icon"></i>
    
    
    
  </a>
    <ul>
        
        




    </ul>
</li>


<li data-nav-id="/outcome/build/" class="dd-item 



">
  <a href="/outcome/build/">
    <span>Build and install</span>

    
    <i class="fa fa-angle-right fa-lg category-icon"></i>
    
    
    
  </a>
    <ul>
        
        




    </ul>
</li>


<li data-nav-id="/outcome/tutorial/" class="dd-item 
parent
active

">
  <a href="/outcome/tutorial/">
    <span>Tutorial</span>

    
    <i class="fa fa-angle-down fa-lg category-icon"></i>
    
    
    
  </a>
    <ul>
        
         
          <li data-nav-id="/outcome/tutorial/error_code/" class="dd-item
         
          ">
            <a href="/outcome/tutorial/error_code/">
            <span>Custom error code</span> 
            

            </a></li>
         
        
        




    </ul>
</li>


<li data-nav-id="/outcome/api-reference/" class="dd-item 



">
  <a href="/outcome/api-reference/">
    <span>API reference</span>

    
    <i class="fa fa-angle-right fa-lg category-icon"></i>
    
    
    
  </a>
    <ul>
        
         
          <li data-nav-id="/outcome/api-reference/doc_outcome.md/" class="dd-item
         
          ">
            <a href="/outcome/api-reference/doc_outcome.md/">
            <span>outcome&lt;R, S, P&gt;</span> 
            

            </a></li>
         
        
         
          <li data-nav-id="/outcome/api-reference/doc_result.md/" class="dd-item
         
          ">
            <a href="/outcome/api-reference/doc_result.md/">
            <span>result&lt;R, S&gt;</span> 
            

            </a></li>
         
        
         
          <li data-nav-id="/outcome/api-reference/doc_try.md/" class="dd-item
         
          ">
            <a href="/outcome/api-reference/doc_try.md/">
            <span>Try operations</span> 
            

            </a></li>
         
        
         
          <li data-nav-id="/outcome/api-reference/doc_utils.md/" class="dd-item
         
          ">
            <a href="/outcome/api-reference/doc_utils.md/">
            <span>Utilities</span> 
            

            </a></li>
         
        
         
          <li data-nav-id="/outcome/api-reference/iostream_support.md/" class="dd-item
         
          ">
            <a href="/outcome/api-reference/iostream_support.md/">
            <span>iostream support</span> 
            

            </a></li>
         
        
        




    </ul>
</li>


<li data-nav-id="/outcome/synopsis/" class="dd-item 



">
  <a href="/outcome/synopsis/">
    <span>Synopsis</span>

    
    <i class="fa fa-angle-right fa-lg category-icon"></i>
    
    
    
  </a>
    <ul>
        
         
          <li data-nav-id="/outcome/synopsis/success/" class="dd-item
         
          ">
            <a href="/outcome/synopsis/success/">
            <span>success&lt;T&gt;</span> 
            

            </a></li>
         
        
         
          <li data-nav-id="/outcome/synopsis/failure/" class="dd-item
         
          ">
            <a href="/outcome/synopsis/failure/">
            <span>failure&lt;EC, E&gt;</span> 
            

            </a></li>
         
        
         
          <li data-nav-id="/outcome/synopsis/result/" class="dd-item
         
          ">
            <a href="/outcome/synopsis/result/">
            <span>result&lt;T, EC&gt;</span> 
            

            </a></li>
         
        
         
          <li data-nav-id="/outcome/synopsis/outcome/" class="dd-item
         
          ">
            <a href="/outcome/synopsis/outcome/">
            <span>outcome&lt;T, EC, E&gt;</span> 
            

            </a></li>
         
        
        




    </ul>
</li>


<li data-nav-id="/outcome/faq/" class="dd-item 



">
  <a href="/outcome/faq/">
    <span>Frequently asked questions</span>

    
    <i class="fa fa-angle-right fa-lg category-icon"></i>
    
    
    
  </a>
    <ul>
        
        




    </ul>
</li>


<li data-nav-id="/outcome/history/" class="dd-item 



">
  <a href="/outcome/history/">
    <span>History</span>

    
    <i class="fa fa-angle-right fa-lg category-icon"></i>
    
    
    
  </a>
    <ul>
        
        




    </ul>
</li>



        
        <section id="shortcuts">
            
                <li class="" role="">
                    <h3>More</h3>
                    <a href="https://github.com/ned14/outcome"><i class='fa fa-github'></i> Outcome 2.0 github repo</a>
                    
                </li>
            
                <li class="" role="">
                    
                    <a href="/outcome/credits"><i class='fa fa-bullhorn'></i> Acknowledgements</a>
                    
                </li>
            
        </section>    
        
        

        
    </ul>
    
     
    <section id="footer">
      <center>

<a class="github-button" href="https://github.com/ned14/outcome/archive/master.zip" data-icon="octicon-cloud-download" aria-label="Download Outcome on GitHub">Download</a>


<a class="github-button" href="https://github.com/ned14/outcome" data-icon="octicon-star" data-show-count="false" aria-label="Star Outcome on GitHub">Star</a>


<a class="github-button" href="https://github.com/ned14/outcome/fork" data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork Outcome on GitHub">Fork</a>

</center>

<script async defer src="https://buttons.github.io/buttons.js"></script>
    </section>
  </div>
</nav>



        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
        
          <div id="top-bar">
            
              
              
              
            <div id="top-github-link">
              <a class="github-link" href="https://github.com/ned14/outcome/edit/develop/doc/src/content/tutorial/_index.md" target="blank">
                <i class="fa fa-code-fork"></i>
                Edit page
              </a>
            </div>
              
            

            <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                <span id="sidebar-toggle-span">
                  <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                    <i class="fa fa-bars"></i>
                  </a>
                </span>
                <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                <span class="links">
                




 <a href='/outcome/'>Home</a> > Tutorial

 

   
                </span>
            </div>
            <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#outcome-2-0-namespace">Outcome 2.0 namespace</a></li>
<li><a href="#creating-result">Creating <code>result&lt;&gt;</code></a></li>
<li><a href="#inspecting-result">Inspecting <code>result&lt;&gt;</code></a></li>
<li><a href="#try-operations"><code>TRY</code> operations</a></li>
<li><a href="#todo-more-material-will-be-provided-in-time">TODO: more material will be provided in time&hellip;</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

          </div>
        
        
        <div id="body-inner">
          
            <h1>Tutorial</h1>
          






<h2 id="outcome-2-0-namespace">Outcome 2.0 namespace</h2>

<p>It is recommended that you refer to entities from this Outcome 2.0 via the following namespace alias:</p>

<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #0000ff">namespace</span> outcome = OUTCOME_V2_NAMESPACE;
</pre></div>



<p>As patches and modifications are applied to this library, namespaces get added in order
not to break any backward compatibility. At some point namespace <code>outcome::v2</code> will be defined,
and this will be the prefered namespace. Until then <code>OUTCOME_V2_NAMESPACE</code> denotes the most recently
updated version, getting closer to <code>outcome::v2</code>.</p>

<h2 id="creating-result">Creating <code>result&lt;&gt;</code></h2>

<p>We will define a function that converts an <code>std::string</code> to an <code>int</code>. This function can fail for a number of reasons;
if it does we want to communicate the failure reason.</p>

<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%">outcome::result&lt;<span style="color: #2b91af">int</span>&gt; convert(<span style="color: #0000ff">const</span> std::string&amp; str) noexcept;
</pre></div>



<p>Class template <code>result&lt;T, EC&gt;</code> has two template parameters. The first (<code>T</code>) represents the type of the object
returned from the function upon succes; the second (<code>EC</code>) is type of object containing information about the reason
for failure when function fails. A <code>result&lt;T, EC&gt;</code> object either stores a <code>T</code> or an <code>EC</code> at any given moment,
and is therefore conceptually similar to <code>boost::variant&lt;T, EC&gt;</code>. <code>EC</code> is defaulted to <code>std::error_code</code>.
If both <code>T</code> and <code>EC</code> are trivially copyable, <code>result&lt;T, EC&gt;</code> is also trivially copyable.</p>

<p>Now, we will define an enumeration describing different failure situations during conversion.</p>

<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #0000ff">enum</span> <span style="color: #0000ff">class</span> <span style="color: #2b91af">ConversionErrc</span>
{
  EmptyString = 1, <span style="color: #008000">// 0 is never an error</span>
  IllegalChar = 2,
  TooLong     = 3,
};

<span style="color: #008000">// all boilerplate necessary to plug ConversionErrc</span>
<span style="color: #008000">// into std::error_code framework</span>
</pre></div>



<p>Assume we have plugged it into <code>std::error_code</code> framework, as described in <a href="error_code">this section</a>.</p>

<p>One notable effect of such plugging is that <code>ConversionErrc</code> is now convertible to <code>std::error_code</code>.
Now we can implement function <code>convert</code> as follows:</p>

<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%">outcome::result&lt;<span style="color: #2b91af">int</span>&gt; convert(<span style="color: #0000ff">const</span> std::string&amp; str) noexcept
{
  <span style="color: #0000ff">if</span> (str.empty())
    <span style="color: #0000ff">return</span> ConversionErrc::EmptyString;
    
  <span style="color: #0000ff">if</span> (!std::all_of(str.begin(), str.end(), ::isdigit))
    <span style="color: #0000ff">return</span> ConversionErrc::IllegalChar;
    
  <span style="color: #0000ff">if</span> (str.length() &gt; 9)
    <span style="color: #0000ff">return</span> ConversionErrc::TooLong;
  
  <span style="color: #0000ff">return</span> atoi(str.c_str());
}
</pre></div>



<p><code>result&lt;T, EC&gt;</code> is convertible from any <code>T2</code> convertible to <code>T</code> as well as any <code>EC2</code> convertible to <code>EC</code>,
provided that the conversion is not ambiguous. If some type <code>X</code> is both convertible to <code>T</code> and <code>EC</code>,
conversion to <code>result&lt;T, EC&gt;</code> fails to compile. In this case you need to use one of the tagged constructors:</p>

<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%">	
outcome::result&lt;<span style="color: #2b91af">int</span>&gt; r {outcome::in_place_type&lt;std::error_code&gt;, ConversionErrc::EmptyString};
outcome::result&lt;<span style="color: #2b91af">int</span>&gt; s {outcome::in_place_type&lt;<span style="color: #2b91af">int</span>&gt;, 1};
</pre></div>



<h2 id="inspecting-result">Inspecting <code>result&lt;&gt;</code></h2>

<p>Suppose we will be writing function <code>print_halve</code> that takes an integral number (however big) represented as an <code>std::string</code> and outputs a number which is twice smaller:</p>

<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%">outcome::result&lt;<span style="color: #2b91af">void</span>&gt; print_half(<span style="color: #0000ff">const</span> std::string&amp; text);
</pre></div>



<p>Type <code>result&lt;void&gt;</code> means that there is no value to be retuned upon success, but that the operation might still fail, and we may be interested in inspecting the cause of the failure. Class template <code>result</code> is declared with attribute <code>[[nodiscard]]</code>, which means compiler will warn you if you forget to inspect the returned object.</p>

<p>The implementation will do the following: if the integral number can be represnted by an <code>int</code>, we will convert to <code>int</code> and use its arithmetical operations. If the number is too large, we will fall back to using a custom <code>BigInt</code> implementation that needs to allocate memory. In the implementation we will use function <code>convert</code> defined in the previous section.</p>

<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%">outcome::result&lt;<span style="color: #2b91af">void</span>&gt; print_half(<span style="color: #0000ff">const</span> std::string&amp; text)
{
    <span style="color: #0000ff">if</span> (outcome::result&lt;<span style="color: #2b91af">int</span>&gt; r = convert(text))         <span style="color: #008000">// #1</span>
    {
        std::cout &lt;&lt; (r.value() / 2) &lt;&lt; std::endl;      <span style="color: #008000">// #2</span>
    }
    <span style="color: #0000ff">else</span>
    {
        <span style="color: #0000ff">if</span> (r.error() == ConversionErrc::TooLong)       <span style="color: #008000">// #3 </span>
        {
            OUTCOME_TRY (i, BigInt::fromString(text));  <span style="color: #008000">// #4</span>
            std::cout &lt;&lt; i.half() &lt;&lt; std::endl;
        }
        <span style="color: #0000ff">else</span>
        {
            <span style="color: #0000ff">return</span> r.as_failure();                      <span style="color: #008000">// #5</span>
        }
    }
    <span style="color: #0000ff">return</span> outcome::success();                          <span style="color: #008000">// #6</span>
}
</pre></div>



<p>#1. You test if <code>result</code> object represents a cuccessful operation with contextual conversion to <code>bool</code>.</p>

<p>#2. Function <code>value</code> extracts the successfully returned result.</p>

<p>#3. Function <code>error</code> allows you to inspect the error sub-object, representing information about the reason for failure.</p>

<p>#4. Macro <code>OUTCOME_TRY</code> represents a control statement. It implies that the function call in the second argument returns a <code>result&lt;&gt;</code>. It is defined as:</p>

<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #008000">/*static*/</span> outcome::result&lt;BigInt&gt; BigInt::fromString(<span style="color: #0000ff">const</span> std::string&amp; s)
</pre></div>



<p>Our control statement means: if <code>fromString</code> returned failure, this same error information should be returned from <code>print_half</code>, even though the type of <code>result&lt;&gt;</code> is different. If <code>fromString</code> returned success, we create  variable <code>i</code> of type <code>int</code> with the value returned from <code>fromString</code>. If control goes to subsequent line, it means <code>fromString</code> succeeded and variable of type <code>int</code> is in scope.</p>

<p>#5. In the return statement we extract the error information and use it to initialize the return value from <code>print_half</code>. We could have written <code>return r.error();</code> instead,
    and it would have the same effect, but it would not work if we were using <code>outcome&lt;&gt;</code> instead of <code>result&lt;&gt;</code> &ndash; this will be covered later.</p>

<p>#6. Function <code>success</code> returns an object of type <code>result&lt;void&gt;</code> representing success.</p>

<h2 id="try-operations"><code>TRY</code> operations</h2>

<p>In the implementation of function <code>print_half</code> we have seen the usage of the macro <code>OUTCOME_TRY</code>:</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%">OUTCOME_TRY (i, BigInt::fromString(text));
</pre></div>

<p>This control statement is raughly equivalent to:</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #0000ff">auto</span>&amp;&amp; __result = BigInt::fromString(text);
<span style="color: #0000ff">if</span> (!__result)
  <span style="color: #0000ff">return</span> __result.as_failure();
<span style="color: #0000ff">auto</span>&amp;&amp; i = __result.value();
</pre></div>

<p>Where <code>__result</code> is a unique name.</p>

<p>Additionally, in GCC and Clang which provide an extension to C++ known as
<a href="https://gcc.gnu.org/onlinedocs/gcc/Statement-Exprs.html" title="GCC docs on statement expressions">statement expressions</a>
it is possible to use an alternative macro: <code>OUTCOME_TRYX</code>, which is an expression. With the above macro, the above declaration of variable <code>i</code> can be rewritten to:</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #2b91af">int</span> i = OUTCOME_TRYX (BigInt::fromString(text));
</pre></div>

<p>This has an advantage that you can use it any place where you can put an expression, e.g., in &ldquo;simple initialization&rdquo;:</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #0000ff">if</span> (<span style="color: #2b91af">int</span> i = OUTCOME_TRYX(BigInt::fromString(text)))
  use_a_non_zero_int(i);
</pre></div>

<p>or in as a subexpression of a bigger full expression:</p>
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #2b91af">int</span> ans = OUTCOME_TRYX(BigInt::fromString(<span style="color: #a31515">&quot;1&quot;</span>)) + OUTCOME_TRYX(BigInt::fromString(<span style="color: #a31515">&quot;2&quot;</span>));
</pre></div>

<div class="notices note" ><p>This macro makes use of a proprietary extension in GCC and clang and is not
portable. The macro is not made available on unsupported compilers,
so you can test for its presence using <code>#ifdef OUTCOME_TRYX</code>.</p>
</div>


<p>Macro <code>OUTCOME_TRY</code> does two things:
1. It extracts a <code>T</code> from <code>result&lt;T&gt;</code> (or <code>outcome&lt;T&gt;</code>).
2. It declares a dependency between statements: If the &ldquo;tried&rdquo; statement fails, the next statement is not executed.</p>

<p>When you are calling functions that return <code>result&lt;void&gt;</code> the first of the two things does not mak sense. You then have to use macro <code>OUTCOME_TRYV</code> instead. Let&rsquo;s use our function <code>print_half</code>:</p>

<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%">outcome::result&lt;<span style="color: #2b91af">void</span>&gt; test()
{
  OUTCOME_TRYV (print_half(<span style="color: #a31515">&quot;2&quot;</span>));
  OUTCOME_TRYV (print_half(<span style="color: #a31515">&quot;X&quot;</span>));
  OUTCOME_TRYV (print_half(<span style="color: #a31515">&quot;4&quot;</span>)); <span style="color: #008000">// will not execute</span>
  <span style="color: #0000ff">return</span> outcome::success();
}
</pre></div>



<p>The first statement will succeed. The second statement will &ldquo;fail&rdquo;, i.e. it will return an errored result. This will cause an immediate return and the subsequent statements will be skipped.</p>

<h2 id="todo-more-material-will-be-provided-in-time">TODO: more material will be provided in time&hellip;</h2>

<p>This will include customizing <code>result</code> and using outcome&hellip;</p>

<div class="mermaid" align="center" >
graph TD
    A1{"result#lt;T, E#gt;"} --"Success"--> B1["T value()"]
    A1 --"Failure"--> C1["E error()"]
    A2{"outcome#lt;T, EC, E|P#gt;"} --"Success"--> B2["T value()"]
    A2 --"Failure"--> C2["EC error()"]
    A2 --> D2(("Either"))
    D2 --"Abort"--> E2["E exception()"]
    D2 --"Payload"--> F2["P payload()"]
</div>


<footer class=" footline" >
	
</footer>





      </div>
    </div>

    
 
    

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                
                
                    
            
            
                
                    
                        
                        
                    
                
                
                
            
        
                    
                
                    
            
            
                
                    
                
                
                
            
        
                    
                
                    
            
            
                
                    
                    
                
                
                
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                
                
            
        
                    
                
                    
            
            
                
                    
                
                
                
            
        
                    
                        
            
            
                
                    
                
                
                
            
        
                    
                        
            
            
                
                    
                
                
                
            
        
                    
                        
            
            
                
                    
                
                
                
            
        
                    
                        
            
            
                
                    
                
                
                
            
        
                    
                        
            
            
                
                    
                
                
                
            
        
                    
                
                    
            
            
                
                    
                
                
                
            
        
                    
                        
            
            
                
                    
                
                
                
            
        
                    
                        
            
            
                
                    
                
                
                
            
        
                    
                        
            
            
                
                    
                
                
                
            
        
                    
                        
            
            
                
                    
                
                
                
            
        
                    
                
                    
            
            
                
                    
                
                
                
            
        
                    
                
                    
            
            
                
                    
                
                
                
            
        
                    
                
            
        
        
        


        
            <a class="nav nav-prev" href="/outcome/build/" title="Build and install"> <i class="fa fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="/outcome/tutorial/error_code/" title="Custom error code" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
        
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/outcome/js/clipboard.min.js"></script>
    <script src="/outcome/js/featherlight.min.js"></script>
    <script src="/outcome/js/html5shiv-printshiv.min.js"></script>
    <script src="/outcome/js/modernizr.custom.71422.js"></script>
    <script src="/outcome/js/learn.js"></script>
    <script src="/outcome/js/hugo-learn.js"></script>

    
    <link href="/outcome/mermaid/mermaid.css" type="text/css" rel="stylesheet"/>
    <script src="/outcome/mermaid/mermaid.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    

    

  </body>
</html>
