<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.29" />
    <meta name="description" content="">


    <title>outcome&lt;T, EC, EP&gt; :: Outcome documentation</title>
    <link rel="shortcut icon" href="/outcome/images/favicon.png" type="image/x-icon" />
    <link href="/outcome/css/nucleus.css" rel="stylesheet">
    <link href="/outcome/css/font-awesome.min.css" rel="stylesheet">
    <link href="/outcome/css/hybrid.css" rel="stylesheet">
    <link href="/outcome/css/featherlight.min.css" rel="stylesheet">
    <link href="/outcome/css/horsey.css" rel="stylesheet">
    
    <link href="/outcome/css/theme.css" rel="stylesheet">
    
    
    <link rel="stylesheet" href="/outcome/css/bootstrap.min.css">
    <script src="/outcome/js/jquery-2.x.min.js"></script>
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left {
        display:none !important;
      }
    </style>

    

    <link href="/outcome/css/local.css" rel="stylesheet">

  </head>
  <body class="" data-url="/outcome/tutorial/outcome/">
    <nav id="sidebar" class=""><div class="highlightable">
  <div id="header-wrapper">
    <div id="header"> 
	<p>Outcome 2.0 library documentation</p>
 


    </div><div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>
<script type="text/javascript" src="/outcome/js/lunr.min.js"></script>
<script type="text/javascript" src="/outcome/js/horsey.js"></script>
<script type="text/javascript">
    var baseurl = "https:\/\/ned14.github.io\/outcome\/";
</script>
<script type="text/javascript" src="/outcome/js/search.js"></script>

  </div>


    <ul class="topics">
            <li data-nav-id="/outcome/" class="dd-item">
            <a href="/outcome/"><i class="fa fa-fw fa-home"></i></a>
            </li>
    <li data-nav-id="/outcome/requirements/" class="dd-item">
      <a href="/outcome/requirements/">
        <span>Prerequisites</span>
      </a>
    </li>
    <li data-nav-id="/outcome/build/" class="dd-item">
      <a href="/outcome/build/">
        <span>Build and install</span>
      </a>
    </li>
    <li data-nav-id="/outcome/tutorial/" class="dd-item parent">
      <a href="/outcome/tutorial/">
        <span>Tutorial</span>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
      </a>
        <ul>
    <li data-nav-id="/outcome/tutorial/result/" class="dd-item">
      <a href="/outcome/tutorial/result/">
        <span>result&lt;T, EC&gt;</span><i class="fa fa-angle-right fa-lg category-icon"></i>
      </a>
        <ul>
      <li data-nav-id="/outcome/tutorial/result/inspecting/" class="dd-item">
        <a href="/outcome/tutorial/result/inspecting/">
          <span>Inspecting result&lt;T, EC&gt;</span>
        </a>
    </li>
      <li data-nav-id="/outcome/tutorial/result/try/" class="dd-item">
        <a href="/outcome/tutorial/result/try/">
          <span>TRY operations</span>
        </a>
    </li>
        </ul>
    </li>
    <li data-nav-id="/outcome/tutorial/outcome/" class="dd-item parent active">
      <a href="/outcome/tutorial/outcome/">
        <span>outcome&lt;T, EC, EP&gt;</span>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
      </a>
        <ul>
      <li data-nav-id="/outcome/tutorial/outcome/inspecting/" class="dd-item">
        <a href="/outcome/tutorial/outcome/inspecting/">
          <span>Inspecting outcome&lt;T, EC, EP&gt;</span>
        </a>
    </li>
        </ul>
    </li>
      <li data-nav-id="/outcome/tutorial/error_code/" class="dd-item">
        <a href="/outcome/tutorial/error_code/">
          <span>Custom error codes</span>
        </a>
    </li>
        </ul>
    </li>
    <li data-nav-id="/outcome/faq/" class="dd-item">
      <a href="/outcome/faq/">
        <span>Frequently asked questions</span>
      </a>
    </li>
    <li data-nav-id="/outcome/history/" class="dd-item">
      <a href="/outcome/history/">
        <span>History</span>
      </a>
    </li>
        <section id="shortcuts">
                <li class="" role=""><a href="/outcome/doxygen/namespaceoutcome__v2__xxx.html" target="_blank" rel="noopener">API reference</a></li>
                <li class="" role=""><h3>More</h3><a href="https://github.com/ned14/outcome" target="_blank" rel="noopener"><i class='fa fa-github'></i> Outcome 2.0 github repo</a></li>
                <li class="" role=""><a href="/outcome/credits" target="_blank" rel="noopener"><i class='fa fa-bullhorn'></i> Acknowledgements</a></li>
        </section>
    </ul>


    <section id="footer"><center>

<a class="github-button" href="https://dedi4.nedprod.com/static/files/outcome-v2.0-source-latest.tar.xz" data-icon="octicon-cloud-download" aria-label="Download Outcome">Download</a>


<a class="github-button" href="https://github.com/ned14/outcome" data-icon="octicon-star" data-show-count="false" aria-label="Star Outcome on GitHub">Star</a>


<a class="github-button" href="https://github.com/ned14/outcome/fork" data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork Outcome on GitHub">Fork</a>

</center>

<script async defer src="https://buttons.github.io/buttons.js"></script>
    </section>
  </div>
</nav>



        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
        
          <div id="top-bar">
            
              
              
              
            <div id="top-github-link">
              <a class="github-link" href="https://github.com/ned14/outcome/edit/develop/doc/src/content/tutorial/outcome/_index.md" target="blank">
                <i class="fa fa-code-fork"></i>
                Edit page
              </a>
            </div><div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                <span id="sidebar-toggle-span">
                  <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                    <i class="fa fa-bars"></i>
                  </a>
                </span>
                <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                <span class="links">
                







 <a href='/outcome/'>Home</a> > <a href='/outcome/tutorial/'>Tutorial</a> > outcome<T, EC, EP>

 

 

   
                </span>
            </div>
            <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#outcome"><code>outcome</code></a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

          </div>
        
        
        <div id="body-inner">
          
            <h1>outcome&lt;T, EC, EP&gt;</h1>
          






<h2 id="outcome"><code>outcome</code></h2>

<p>Type <code>outcome&lt;T, EC, EP&gt;</code> can store either a <code>T</code> or an <code>EC</code> or an <code>EP</code>.
The first parameter (<code>T</code>) represents a value returned from functions upon success.
Both <code>EC</code> and <code>EP</code> represent the reason for function failure when function fails.
Conceptually, <code>outcome&lt;T, EC, EP&gt;</code> can be thought of as <code>variant&lt;T, EC, EP&gt;</code> or <code>variant&lt;T, variant&lt;EC, EP&gt;&gt;</code>, or <code>result&lt;variant&lt;EC, EP&gt;&gt;</code>.
<code>EC</code> defaults to <code>std::error_code</code> and <code>EP</code> defaults to <code>std::exception_ptr</code>. THe distinction is made into two types, <code>EC</code> and <code>EP</code> for the following reasosns:</p>

<ol>
<li>The interface: <code>EC</code> is inspected in a different way that <code>EP</code>.</li>
<li>Performance: handling of <code>EC</code> is optimized for POD types.</li>
<li>Interoperability with <code>result&lt;T, EC&gt;</code>: like converisons.</li>
</ol>

<p><code>outcome&lt;T, EC, EP&gt;</code> is useful for transporting exceptions across layers of the program that was never designed with exception_ptr`safety in mind.</p>

<p>Consider a program consisting of three layers:</p>

<pre><code>Layer3
  ^
  |
Layer2NX
  ^
  |
Layer1
</code></pre>

<p>The highest-level layer, <code>Layer3</code>, uses exceptions for signalling failures. The middle layer, <code>Layer2NX</code>,
was not designed with exception safety in mind and function need to return information about failures in return value.
But down in the implementation details, in <code>Layer1</code>, another library is used that again throws exceptions. The goal is
to be able to transfer an exception thrown in <code>Layer1</code> through <code>Layer2</code>, which is not exception-safe, and be able to rethrow it in <code>Layer3</code>.</p>

<p>In <code>Layer1</code> we have a throwing function:</p>

<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++">
<span class="s3e8">namespace</span> Layer1
{
  <span class="s3e8">auto</span> f() -&gt; <span class="s3ee">int</span>; <span class="s1770">// may throw
</span><span class="s1770"></span>}  
</code></pre>
</div>


<p>In <code>Layer2NX</code> we cannot use exceptions, so its function <code>g</code> uses <code>result&lt;&gt;</code> to report failures:</p>

<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++">
<span class="s3e8">namespace</span> Layer2NX
{
  <span class="s3e8">auto</span> g() <span class="s3e8">noexcept</span> -&gt; outcome::result&lt;<span class="s3ee">int</span>&gt; ;
}
</code></pre>
</div>


<p>There is another function in <code>Layer2NX</code> that has to use both <code>Layer1::f</code> and <code>Layer2NX::g</code>.
It cannot use <code>Layer1::f</code> directly as the later may throw an exception, so it has to wrap it into a non-throwing function <code>Layer2NX::f</code>:</p>

<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++">
<span class="s3e8">namespace</span> Layer2NX
{   
  <span class="s3e8">auto</span> f() <span class="s3e8">noexcept</span> -&gt; outcome::outcome&lt;<span class="s3ee">int</span>&gt; 
  <span class="s3e8">try</span> {
    <span class="s3e8">return</span> Layer1::f();
  }
  <span class="s3e8">catch</span> (...) {
    <span class="s3e8">return</span> std::current_exception();
  }
}    
</code></pre>
</div>


<p>This wrapper funciton returns type <code>outcome&lt;int&gt;</code>. If an exception is thrown, it is caught by an <code>std::exception_ptr</code>. This <code>std::exception_ptr</code> is converted to <code>outcome&lt;T&gt;</code> upon return.
<code>outcome&lt;T, EC, EP&gt;</code> is convertible from <code>T</code>, <code>EC</code> and <code>EP</code> as long as such conversion is not ambiguous.</p>

<p>Now function <code>Layer2NX::fun</code> can be implemented with non-throwing <code>Layer2NX::f</code> and <code>Layer2NX::g</code>:</p>

<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++">    
<span class="s3e8">namespace</span> Layer2NX
{  
  <span class="s3e8">auto</span> fun() <span class="s3e8">noexcept</span> -&gt; outcome::outcome&lt;<span class="s3ee">double</span>&gt; 
  {
    Resource* resource = <span class="s3e8">new</span> (std::nothrow) Resource;
    <span class="s3e8">if</span> (!resource)
        <span class="s3e8">return</span> std::errc::not_enough_memory;
      
    outcome::outcome&lt;<span class="s3ee">int</span>&gt; fr = Layer2NX::f();
    <span class="s3e8">if</span> (!fr) {
      <span class="s3e8">delete</span> resource;
      <span class="s3e8">return</span> fr.as_failure();                <span class="s1770">// #1
</span><span class="s1770"></span>    }
    
    <span class="s3ee">double</span> ans = resource-&gt;use(fr.value());
    
    outcome::result&lt;<span class="s3ee">int</span>&gt; gr = Layer2NX::g();
    <span class="s3e8">if</span> (!gr) {
      <span class="s3e8">delete</span> resource;
      <span class="s3e8">return</span> gr.as_failure();
    }
    
    ans += resource-&gt;use(gr.value());
    
    <span class="s3e8">delete</span> resource;
    <span class="s3e8">return</span> ans;
  }
}
</code></pre>
</div>


<p>In the example above, manually deleting <code>resource</code> represents a non-exception-safe code.
Typically it is not recommended to manually delete memory because it is hard to get right in case exceptions are thrown.
But when exceptions are known not to be thrown (e.g., when they are disabled) this recommendation is weakened.</p>

<p>#1. When we want to forward (return up) the <code>outcome&lt;&gt;</code> object representing failure, we use function <code>as_failure()</code> it returns type <code>failure_type&lt;EC, EP&gt;</code> which is convertible to any to <code>outcome&lt;T, EC, EP&gt;</code> for any <code>T</code>.</p>

<p>#2. We can similarly forward a failure from <code>result&lt;&gt;</code> again by calling <code>as_failure()</code>, the result will be converted to <code>outcome&lt;&gt;</code> preserving the information about function failure.</p>

<p>If the management of <code>resource</code> is automated through RAII, even with exceptions disabled, you can use <code>OUTCOME_TRY</code> to make the code more concise:</p>

<div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++">    
<span class="s3e8">namespace</span> Layer2NX
{  
  <span class="s3e8">auto</span> fun2() <span class="s3e8">noexcept</span> -&gt; outcome::outcome&lt;<span class="s3ee">double</span>&gt; 
  {
    std::unique_ptr&lt;Resource&gt; resource {<span class="s3e8">new</span> (std::nothrow) Resource};
    <span class="s3e8">if</span> (!resource)
      <span class="s3e8">return</span> std::errc::not_enough_memory;
    
    OUTCOME_TRY (fr, Layer2NX::f());
    <span class="s3ee">double</span> ans = resource-&gt;use(fr);
    
    OUTCOME_TRY (gr, Layer2NX::g());
    ans += resource-&gt;use(gr);
    
    <span class="s3e8">return</span> ans;
  }
}
</code></pre>
</div>


<p>Statement <code>OUTCOME_TRY</code> works for <code>outcome</code> and you can also use it to return failure from <code>result&lt;&gt;</code> as <code>outcome&lt;&gt;</code> as shown in the second <code>OUTCOME_TRY</code>.</p>


<footer class=" footline" >
	
</footer>






        

      </div>
    </div>

    
 
    

    <div id="navigation">
        <a class="nav nav-prev" href="/outcome/tutorial/result/try/" title="TRY operations"> <i class="fa fa-chevron-left"></i></a>
        <a class="nav nav-next" href="/outcome/tutorial/outcome/inspecting/" title="Inspecting outcome&lt;T, EC, EP&gt;" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>    

    <script src="/outcome/js/clipboard.min.js"></script>
<script src="/outcome/js/featherlight.min.js"></script>
<script src="/outcome/js/html5shiv-printshiv.min.js"></script>


<script src="/outcome/js/modernizr.custom.71422.js"></script>
<script src="/outcome/js/learn.js"></script>
<script src="/outcome/js/hugo-learn.js"></script>


<link href="/outcome/mermaid/mermaid.css" type="text/css" rel="stylesheet"/>
<script src="/outcome/mermaid/mermaid.js"></script>
<script>mermaid.initialize({startOnLoad:true});</script>
    

  </body>
</html>
