<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.29" />
    <meta name="description" content="">


    <title>Upgrading the Filesystem TS :: Outcome documentation</title>
    <link rel="shortcut icon" href="/outcome/images/favicon.png" type="image/x-icon" />
    <link href="/outcome/css/nucleus.css" rel="stylesheet">
    <link href="/outcome/css/font-awesome.min.css" rel="stylesheet">
    <link href="/outcome/css/hybrid.css" rel="stylesheet">
    <link href="/outcome/css/featherlight.min.css" rel="stylesheet">
    <link href="/outcome/css/horsey.css" rel="stylesheet">
    
    <link href="/outcome/css/theme.css" rel="stylesheet">
    
    
    <link rel="stylesheet" href="/outcome/css/bootstrap.min.css">
    <script src="/outcome/js/jquery-2.x.min.js"></script>
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left {
        display:none !important;
      }
    </style>

    

    <link href="/outcome/css/local.css" rel="stylesheet">

  </head>
  <body class="" data-url="/outcome/tutorial/outcome/payload/copy_file2/">
    <nav id="sidebar" class=""><div class="highlightable">
  <div id="header-wrapper">
    <div id="header"> 
	<p>Outcome 2.0 library documentation</p>
 


    </div><div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>
<script type="text/javascript" src="/outcome/js/lunr.min.js"></script>
<script type="text/javascript" src="/outcome/js/horsey.js"></script>
<script type="text/javascript">
    var baseurl = "https:\/\/ned14.github.io\/outcome\/";
</script>
<script type="text/javascript" src="/outcome/js/search.js"></script>

  </div>


    <ul class="topics">
            <li data-nav-id="/outcome/" class="dd-item">
            <a href="/outcome/"><i class="fa fa-fw fa-home"></i></a>
            </li>
    <li data-nav-id="/outcome/requirements/" class="dd-item">
      <a href="/outcome/requirements/">
        <span>Prerequisites</span>
      </a>
    </li>
    <li data-nav-id="/outcome/build/" class="dd-item">
      <a href="/outcome/build/">
        <span>Build and install</span>
      </a>
    </li>
    <li data-nav-id="/outcome/tutorial/" class="dd-item parent">
      <a href="/outcome/tutorial/">
        <span>Tutorial</span>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
      </a>
        <ul>
    <li data-nav-id="/outcome/tutorial/result/" class="dd-item">
      <a href="/outcome/tutorial/result/">
        <span>result&lt;T, EC&gt;</span><i class="fa fa-angle-right fa-lg category-icon"></i>
      </a>
        <ul>
      <li data-nav-id="/outcome/tutorial/result/inspecting/" class="dd-item">
        <a href="/outcome/tutorial/result/inspecting/">
          <span>Inspecting result&lt;T, EC&gt;</span>
        </a>
    </li>
      <li data-nav-id="/outcome/tutorial/result/try/" class="dd-item">
        <a href="/outcome/tutorial/result/try/">
          <span>TRY operations</span>
        </a>
    </li>
        </ul>
    </li>
    <li data-nav-id="/outcome/tutorial/outcome/" class="dd-item parent">
      <a href="/outcome/tutorial/outcome/">
        <span>outcome&lt;T, EC, EP&gt;</span>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
      </a>
        <ul>
      <li data-nav-id="/outcome/tutorial/outcome/inspecting/" class="dd-item">
        <a href="/outcome/tutorial/outcome/inspecting/">
          <span>Inspecting outcome&lt;T, EC, EP&gt;</span>
        </a>
    </li>
    <li data-nav-id="/outcome/tutorial/outcome/payload/" class="dd-item parent">
      <a href="/outcome/tutorial/outcome/payload/">
        <span>Outcome with payload</span>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
      </a>
        <ul>
      <li data-nav-id="/outcome/tutorial/outcome/payload/copy_file/" class="dd-item">
        <a href="/outcome/tutorial/outcome/payload/copy_file/">
          <span>The Filesystem TS</span>
        </a>
    </li>
      <li data-nav-id="/outcome/tutorial/outcome/payload/copy_file2/" class="dd-item active">
        <a href="/outcome/tutorial/outcome/payload/copy_file2/">
          <span>Upgrading the Filesystem TS</span>
        </a>
    </li>
      <li data-nav-id="/outcome/tutorial/outcome/payload/copy_file3/" class="dd-item">
        <a href="/outcome/tutorial/outcome/payload/copy_file3/">
          <span>Throwing filesystem_error</span>
        </a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
      <li data-nav-id="/outcome/tutorial/error_code/" class="dd-item">
        <a href="/outcome/tutorial/error_code/">
          <span>Custom error codes</span>
        </a>
    </li>
        </ul>
    </li>
    <li data-nav-id="/outcome/faq/" class="dd-item">
      <a href="/outcome/faq/">
        <span>Frequently asked questions</span>
      </a>
    </li>
    <li data-nav-id="/outcome/history/" class="dd-item">
      <a href="/outcome/history/">
        <span>History</span>
      </a>
    </li>
        <section id="shortcuts">
                <li class="" role=""><a href="/outcome/standardese/standardese_entities.html" target="_blank" rel="noopener">API reference (standardese)</a></li>
                <li class="" role=""><a href="/outcome/doxygen/namespaceoutcome__v2__xxx.html" target="_blank" rel="noopener">API reference (doxygen)</a></li>
                <li class="" role=""><h3>More</h3><a href="https://github.com/ned14/outcome" target="_blank" rel="noopener"><i class='fa fa-github'></i> Outcome 2.0 github repo</a></li>
                <li class="" role=""><a href="/outcome/credits" target="_blank" rel="noopener"><i class='fa fa-bullhorn'></i> Acknowledgements</a></li>
        </section>
    </ul>


    <section id="footer"><center>

<a class="github-button" href="https://dedi4.nedprod.com/static/files/outcome-v2.0-source-latest.tar.xz" data-icon="octicon-cloud-download" aria-label="Download Outcome">Download</a>


<a class="github-button" href="https://github.com/ned14/outcome" data-icon="octicon-star" data-show-count="false" aria-label="Star Outcome on GitHub">Star</a>


<a class="github-button" href="https://github.com/ned14/outcome/fork" data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork Outcome on GitHub">Fork</a>

</center>

<script async defer src="https://buttons.github.io/buttons.js"></script>
    </section>
  </div>
</nav>



        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
        
          <div id="top-bar">
            
              
              
              
            <div id="top-github-link">
              <a class="github-link" href="https://github.com/ned14/outcome/edit/develop/doc/src/content/tutorial/outcome/payload/copy_file2.md" target="blank">
                <i class="fa fa-code-fork"></i>
                Edit page
              </a>
            </div><div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                <span id="sidebar-toggle-span">
                  <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                    <i class="fa fa-bars"></i>
                  </a>
                </span>
                <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                <span class="links">
                













 <a href='/outcome/'>Home</a> > <a href='/outcome/tutorial/'>Tutorial</a> > <a href='/outcome/tutorial/outcome/'>outcome<T, EC, EP></a> > <a href='/outcome/tutorial/outcome/payload/'>Outcome with payload</a> > Upgrading the Filesystem TS

 

 

 

 

   
                </span>
            </div>
            <div class="progress">
    <div class="wrapper">

    </div>
</div>

          </div>
        
        
        <div id="body-inner">
          
            <h1>Upgrading the Filesystem TS</h1>
          




<p>An Outcome based solution looks deceptively simple initially, but there is more to it than it appears.</p>

<div class="code-snippet"><div class="highlight"><pre class="chroma"><code class="language-c++" data-lang="c++">
<span class="s3e8">namespace</span> filesystem2
{
  <span class="s1770">// Paths related to a failure. Also causes ADL discovery to check this namespace.
</span><span class="s1770"></span>  <span class="s3e8">struct</span> failure_info
  {
    path path1, path2;
  };

  <span class="s1770">// Localise an outcome implementation specific to this namespace. Normally would just
</span><span class="s1770"></span>  <span class="s1770">// be `result`, but for clarity we&#39;ll use `fs_result`.
</span><span class="s1770"></span>  <span class="s3e8">template</span> &lt;<span class="s3e8">class</span> <span class="s7d4">T</span>&gt; <span class="s3e8">using</span> fs_result = outcome::outcome&lt;T, std::error_code, failure_info&gt;;

  <span class="s1770">/*! Copies the file at path `from` to path `to`.
</span><span class="s1770">  \returns Successful if file was successfully copied, otherwise the error code reported
</span><span class="s1770">  by the operating system plus a payload of the paths involved.
</span><span class="s1770">  \throws Never throws.
</span><span class="s1770">  */</span>
  fs_result&lt;<span class="s3ee">void</span>&gt; copy_file(<span class="s3e8">const</span> path &amp;from, <span class="s3e8">const</span> path &amp;to) <span class="s3e8">noexcept</span>;
}
</code></pre>
</div><a href="https://github.com/ned14/outcome/tree/master/doc/src/snippets/outcome_payload.cpp#L38" class="code-snippet-url" target="_blank">View this code on Github</a></div>


<p>Starting at the bottom, there is now a single <code>copy_file()</code> function which returns a <code>fs_result&lt;void&gt;</code>.
As outcomes are either successful or not, there is no longer any point in returning a boolean, so we
simply return <code>void</code> on success. On failure, as the template alias <code>fs_result&lt;T&gt;</code> above it shows,
we are returned an error code plus a <code>failure_info</code> structure containing the same additional information
as <code>filesystem_error</code> provides.</p>

<p>It is important to note that the fact that <code>failure_info</code> is defined in namespace <code>filesystem2</code> is very
important. This is because Outcome has no idea, for obvious reasons, what to do when someone tries to
access the successful state of an errored outcome with payload. We therefore must tell Outcome by declaring
a special free function discovered via ADL what to do.</p>


<footer class=" footline" >
	
</footer>




        

      </div>
    </div>

    
 
    

    <div id="navigation">
        <a class="nav nav-prev" href="/outcome/tutorial/outcome/payload/copy_file/" title="The Filesystem TS"> <i class="fa fa-chevron-left"></i></a>
        <a class="nav nav-next" href="/outcome/tutorial/outcome/payload/copy_file3/" title="Throwing filesystem_error" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>    

    <script src="/outcome/js/clipboard.min.js"></script>
<script src="/outcome/js/featherlight.min.js"></script>
<script src="/outcome/js/html5shiv-printshiv.min.js"></script>


<script src="/outcome/js/modernizr.custom.71422.js"></script>
<script src="/outcome/js/learn.js"></script>
<script src="/outcome/js/hugo-learn.js"></script>


<link href="/outcome/mermaid/mermaid.css" type="text/css" rel="stylesheet"/>
<script src="/outcome/mermaid/mermaid.js"></script>
<script>mermaid.initialize({startOnLoad:true});</script>
    

  </body>
</html>

